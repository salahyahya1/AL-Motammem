<div *ngIf="menuOpen && isMobile" class="fixed inset-0 z-40 bg-black/30" (click)="closeMenu()"></div>
<header #navbar class="navbar fixed top-0 left-0 right-0 w-full z-50">
    <div
        class=" mx-auto flex flex-col-reverse justify-center md:gap-x-2 lg:gap-x-4 items-center md:flex-row ltr:md:flex-row-reverse md:items-center md:justify-between md:py-0 min-[800px]:px-2 min-[1100px]:px-4">
        <nav #navbarMenu
            class=" flex md:space-x-4 flex-col gap-y-2 pt-2 md:pt-0 md:gap-y-0 justify-center items-center md:flex-row ltr:md:flex-row-reverse md:justify-between md:items-center text-md font-medium w-full">
            <!-- Search Bar -->
            <div #searchContainer class="relative group md:mr-4 flex items-center">
                <!-- Single Search Container with Smooth Transition -->
                <div class="relative flex items-center bg-[var(--light-light-gray)] rounded-full transition-all duration-300 ease-in-out cursor-pointer overflow-hidden shadow-sm"
                    [class.w-9]="!isSearchOpen" [class.h-9]="!isSearchOpen" [class.w-[215px]]="isSearchOpen"
                    [class.lg:w-[250px]]="isSearchOpen" [class.h-9]="isSearchOpen" [class.cursor-default]="isSearchOpen"
                    (click)="openSearch(); $event.stopPropagation()">

                    <!-- Search Icon (Acting as trigger when closed) -->
                    <div class="shrink-0 w-9 h-9 flex items-center justify-center text-gray-500 z-10">
                        <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>

                    <!-- Input (Hidden when closed) -->
                    <input #searchInput [formControl]="searchControl" (focus)="onSearchFocus()"
                        (keyup.enter)="onSearchSubmit()" type="text"
                        class="bg-transparent border-none outline-none text-sm h-full absolute inset-0 ltr:pl-10 rtl:pr-10 ltr:pr-8 rtl:pl-8 w-full transition-opacity duration-300 ease-in-out placeholder-gray-500 text-[var(--dark-gray)]"
                        [class.opacity-0]="!isSearchOpen" [class.pointer-events-none]="!isSearchOpen"
                        [class.opacity-100]="isSearchOpen" [class.pointer-events-auto]="isSearchOpen"
                        [placeholder]="'NAVBAR.SEARCH' | translate" (click)="$event.stopPropagation()">

                    <!-- Close Button (Hidden when closed) -->
                    <button (click)="closeSearch(); $event.stopPropagation()" type="button"
                        [attr.aria-label]="'NAVBAR.CLOSE_SEARCH' | translate" [attr.aria-expanded]="isSearchOpen"
                        class="absolute ltr:right-1 rtl:left-1 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 w-7 h-7 flex items-center justify-center rounded-full hover:bg-gray-200 focus:outline-none transition-all duration-300 z-20"
                        [class.opacity-0]="!isSearchOpen" [class.scale-0]="!isSearchOpen"
                        [class.pointer-events-none]="!isSearchOpen" [class.opacity-100]="isSearchOpen"
                        [class.scale-100]="isSearchOpen">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Dropdown Results (Only shows if open) -->
                <div *ngIf="isSearchOpen && showResults && (searchControl.value?.length || 0) >= 2"
                    class="absolute top-[calc(100%+0.5rem)] w-[300px] md:w-[400px] bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden z-[60] ltr:left-0 rtl:right-0 ltr:origin-top-left rtl:origin-top-right">

                    <!-- Loading State -->
                    <div *ngIf="searchLoading"
                        class="p-4 text-center text-gray-500 text-sm flex items-center justify-center gap-2">
                        <svg class="animate-spin h-5 w-5 text-[var(--primary)]" xmlns="http://www.w3.org/2000/svg"
                            fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        <span>{{ 'SEARCH.LOADING' | translate }}</span>
                    </div>

                    <!-- No Results -->
                    <div *ngIf="!searchLoading && searchResults.length === 0"
                        class="p-4 text-center text-gray-500 text-sm">
                        {{ 'SEARCH.NO_RESULTS' | translate }}
                    </div>

                    <!-- Results List -->
                    <div *ngIf="!searchLoading && searchResults.length > 0" class="max-h-[60vh] overflow-y-auto">
                        <div *ngFor="let result of searchResults" (click)="navigateToResult(result)"
                            class="p-3 border-b border-gray-50 hover:bg-gray-50 cursor-pointer transition-colors block group/item">
                            <div class="flex justify-between items-start gap-2 mb-1">
                                <h4
                                    class="text-sm font-semibold text-[var(--dark-gray)] group-hover/item:text-[var(--primary)] transition-colors">
                                    {{ result.title.includes('.') ? (result.title | translate) : result.title }}
                                </h4>
                                <span *ngIf="result.source === 'blog'"
                                    class="shrink-0 px-2 py-0.5 text-[0.6rem] font-medium bg-blue-50 text-blue-600 rounded-full border border-blue-100">
                                    {{ 'SEARCH.BADGE_BLOG' | translate }}
                                </span>
                                <span *ngIf="result.source === 'faq'"
                                    class="shrink-0 px-2 py-0.5 text-[0.6rem] font-medium bg-orange-50 text-orange-600 rounded-full border border-orange-100">
                                    {{ 'SEARCH.BADGE_FAQ' | translate }}
                                </span>
                                <span *ngIf="result.source === 'site'"
                                    class="shrink-0 px-2 py-0.5 text-[0.6rem] font-medium bg-gray-100 text-gray-500 rounded-full border border-gray-200">
                                    {{ 'SEARCH.BADGE_SITE' | translate }}
                                </span>
                            </div>
                            <p class="text-xs text-gray-500 line-clamp-2">
                                {{ result.snippet }}
                            </p>
                        </div>
                        <div class="p-2 bg-gray-50 text-center">
                            <button (click)="onSearchSubmit()"
                                class="text-xs text-[var(--primary)] font-medium hover:underline">
                                {{ 'SEARCH.VIEW_ALL' | translate }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div
                class="contents md:relative md:flex md:space-x-4 flex-col gap-y-2 md:pt-0 md:gap-y-0 justify-center items-center md:flex-row md:justify-start md:items-center flex-wrap">
                <a [routerLink]="['']" (click)="closeMenuOnMobile()" routerLinkActive="nav-active"
                    [routerLinkActiveOptions]="{ exact: true }" class="hover:text-primary whitespace-nowrap">{{
                    'NAVBAR.MAIN' | translate }} </a>
                <a routerLink="/about" (click)="closeMenuOnMobile()" routerLinkActive="nav-active"
                    class="hover:text-primary whitespace-nowrap">{{
                    'NAVBAR.ABOUT-US' | translate }}
                </a>
                <a routerLink="/solutions" (click)="closeMenuOnMobile()" routerLinkActive="nav-active"
                    class="hover:text-primary whitespace-nowrap">{{
                    'NAVBAR.SOLUTIONS' |
                    translate }}
                </a>
                <a routerLink="/products" (click)="closeMenuOnMobile()" routerLinkActive="nav-active"
                    class="hover:text-primary whitespace-nowrap">{{
                    'NAVBAR.PRODUCTS' | translate
                    }}</a>
                <a routerLink="/blogs" (click)="closeMenuOnMobile()" routerLinkActive="nav-active"
                    class="hover:text-primary whitespace-nowrap">{{
                    'NAVBAR.kNOWLEDGE' | translate
                    }}</a>
                <a routerLink="/FAQS" (click)="closeMenuOnMobile()" routerLinkActive="nav-active"
                    class="hover:text-primary whitespace-nowrap">{{
                    'NAVBAR.SUPPORT' | translate
                    }}</a>
                <a routerLink="/ContactUs" (click)="closeMenuOnMobile()" routerLinkActive="nav-active"
                    class="hover:text-primary whitespace-nowrap">{{
                    'NAVBAR.CONTACT' | translate
                    }}</a>
                <!-- Language Dropdown -->
                <div class="relative inline-block" (click)="$event.stopPropagation()" #langContainer>
                    <!-- Trigger -->
                    <button type="button" (click)="toggleLangDropdown()" class="inline-flex items-center gap-2 rounded-full bg-[var(--light-light-gray)] px-3 py-2 text-xs font-semibold
           text-[color:var(--dark-gray)] hover:bg-gray-200 transition select-none" aria-haspopup="listbox"
                        [attr.aria-expanded]="isLangOpen">
                        <span class="uppercase">{{ currentLang }}</span>

                        <!-- chevron -->
                        <svg class="w-4 h-4 opacity-70 transition-transform" [class.rotate-180]="isLangOpen"
                            viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>

                    <!-- Menu -->
                    <div *ngIf="isLangOpen" class="absolute z-[80] mt-2 w-28 rounded-xl bg-white shadow-xl border border-gray-100 overflow-hidden
         rtl:right-0 ltr:left-0
         text-[color:var(--dark-gray)]" role="listbox">
                        <button type="button" (click)="setLang('en'); closeLangDropdown()" class="w-full px-3 py-2 text-sm text-left hover:bg-gray-50 transition flex items-center justify-between
           text-[color:var(--dark-gray)]"
                            [ngClass]="currentLang === 'en' ? 'font-semibold text-[color:var(--primary)]' : ''">
                            EN
                            <span *ngIf="currentLang === 'en'" class="text-[color:var(--primary)]">✓</span>
                        </button>

                        <button type="button" (click)="setLang('ar'); closeLangDropdown()" class="w-full px-3 py-2 text-sm text-left hover:bg-gray-50 transition flex items-center justify-between
           text-[color:var(--dark-gray)]"
                            [ngClass]="currentLang === 'ar' ? 'font-semibold text-[color:var(--primary)]' : ''">
                            AR
                            <span *ngIf="currentLang === 'ar'" class="text-[color:var(--primary)]">✓</span>
                        </button>
                    </div>

                </div>
                <button (click)="closeMenuOnMobile(); logout()" [hidden]="isAuthenticated && hasrole ? 'visible' : 'hidden'" 
                class="hover:text-primary whitespace-nowrap bg-red-500 rounded-full px-3 py-1">{{
                'NAVBAR.LOGOUT' | translate
                }}</button>
            </div>


            <!-- <div class="inline-flex items-center rounded-full bg-[var(--light-light-gray)] p-1 text-xs font-medium">
                <button type="button" class="px-3 py-1 rounded-full transition-colors whitespace-nowrap" [ngClass]="currentLang === 'ar'
      ? 'bg-[var(--primary)] text-white'
      : 'text-[color:var(--dark-gray)]'" (click)="setLang('ar')" [disabled]="currentLang === 'ar'">
                    AR
                </button>

                <button type="button" class="px-3 py-1 rounded-full transition-colors whitespace-nowrap" [ngClass]="currentLang === 'en'
      ? 'bg-[var(--primary)] text-white'
      : 'text-[color:var(--dark-gray)]'" (click)="setLang('en')" [disabled]="currentLang === 'en'">
                    EN
                </button>
            </div> -->


        </nav>
        <div #navSmallScreen class="navSmallScreen w-full h-full md:w-[30%]">
            <div class="w-[90%] flex flex-row-reverse ltr:md:flex-row justify-between items-center mx-auto">
                <div class="gap-x-2 mt-1 ltr:flex rtl:hidden">
                    <svg width="30" height="38" viewBox="0 0 30 38" fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M29.8651 21.1765C29.8651 21.0745 29.8651 20.9506 29.8579 20.8996C29.8073 19.3615 29.6266 17.1091 29.0482 14.3464C28.9831 13.9965 28.8096 13.3842 28.2963 12.8813C27.6891 12.2835 26.9155 12.1523 26.4094 12.1013C23.4237 11.766 19.5631 12.7646 16.2304 13.6539C15.7821 13.7706 15.399 13.8799 15.0953 13.9601C14.7917 13.8799 14.4013 13.7779 13.9603 13.6539C10.6275 12.7646 6.76698 11.766 3.78121 12.1013C3.28238 12.1596 2.5016 12.2835 1.89432 12.8813C1.38826 13.3842 1.21475 13.9965 1.14246 14.3464C0.556871 17.1018 0.383363 19.3615 0.332757 20.8996C0.332757 20.9506 0.332757 21.0745 0.325528 21.1765C0.325528 21.1765 0.15202 27.9046 1.07739 33.9402C1.07739 33.9548 1.07739 33.9694 1.07739 33.9694C1.35211 35.7188 1.88709 36.2582 1.88709 36.2582C1.98831 36.3603 2.08952 36.4404 2.1835 36.5061C2.1835 36.5061 2.3064 36.5862 2.44376 36.6591C3.05827 36.9653 3.91857 37.0673 3.91857 37.0673C5.10421 37.2058 5.41507 37.2131 5.41507 37.2131C7.38872 37.3881 10.3383 37.5849 15.0664 37.5849C15.0664 37.5849 15.0809 37.5849 15.0881 37.5849C15.0953 37.5849 15.1026 37.5849 15.1098 37.5849C19.8379 37.5849 22.7875 37.3881 24.7611 37.2131C24.7611 37.2131 25.072 37.2131 26.2576 37.0673C26.2576 37.0673 27.1179 36.9653 27.7324 36.6591C27.8698 36.5935 27.9927 36.5061 27.9927 36.5061C28.0867 36.4404 28.1879 36.3676 28.2891 36.2582C28.2891 36.2582 28.8241 35.7188 29.0988 33.9694C29.0988 33.9694 29.0988 33.9548 29.0988 33.9402C30.0242 27.9119 29.8507 21.1765 29.8507 21.1765H29.8651Z" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M14.958 12.6845C8.40807 11.7514 4.05593 8.11404 3.07996 0.32172C12.0445 2.12948 13.7506 4.87028 14.958 12.6845Z" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M22.2597 4.5787C17.3003 5.47529 15.0736 8.38374 14.6471 12.5678C14.7483 12.6116 14.8568 12.648 14.958 12.6845C19.7366 11.6421 21.4139 10.3373 22.2525 4.5787H22.2597Z" />
                    </svg>
                    <div class="text-[color:var(--dark-gray)] transition-colors duration-300 brand-text"
                        id="brand-text">
                        <div class="flex flex-col items-end">
                            <span class="text-xl font-medium whitespace-nowrap">Al-Motammem</span>
                            <span class="text-xs font-light">40 years of ERP</span>
                        </div>
                    </div>


                </div>
                <div class="mt-1 rtl:flex ltr:hidden items-center">


                    <!-- Text block -->
                    <div id="brand-text"
                        class="brand-text text-[color:var(--dark-gray)] transition-colors duration-300 select-none">
                        <!-- سطر 1: EN + divider + AR -->
                        <div class="flex flex-row-reverse items-start leading-none">
                            <span
                                class="text-lg font-semibold tracking-wide whitespace-nowrap ps-0.5">Al-Motammem</span>
                            <span class="inline-block w-[2px] h-7 bg-current rounded-sm" id="navbar-seprator"></span>

                            <!-- Arabic + subtitle تحتها -->
                            <div class="flex flex-col items-start">
                                <span class="text-[23px] font-semibold whitespace-nowrap" dir="rtl">المُتَمِّم</span>
                                <span class="text-xs font-medium pt-[5px] whitespace-nowrap" dir="rtl">٤٠ عام من
                                    الخبرة</span>
                            </div>
                        </div>
                    </div>

                    <svg class="shrink-0" width="50" height="55" viewBox="0 0 30 45" fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M29.8651 21.1765C29.8651 21.0745 29.8651 20.9506 29.8579 20.8996C29.8073 19.3615 29.6266 17.1091 29.0482 14.3464C28.9831 13.9965 28.8096 13.3842 28.2963 12.8813C27.6891 12.2835 26.9155 12.1523 26.4094 12.1013C23.4237 11.766 19.5631 12.7646 16.2304 13.6539C15.7821 13.7706 15.399 13.8799 15.0953 13.9601C14.7917 13.8799 14.4013 13.7779 13.9603 13.6539C10.6275 12.7646 6.76698 11.766 3.78121 12.1013C3.28238 12.1596 2.5016 12.2835 1.89432 12.8813C1.38826 13.3842 1.21475 13.9965 1.14246 14.3464C0.556871 17.1018 0.383363 19.3615 0.332757 20.8996C0.332757 20.9506 0.332757 21.0745 0.325528 21.1765C0.325528 21.1765 0.15202 27.9046 1.07739 33.9402C1.07739 33.9548 1.07739 33.9694 1.07739 33.9694C1.35211 35.7188 1.88709 36.2582 1.88709 36.2582C1.98831 36.3603 2.08952 36.4404 2.1835 36.5061C2.1835 36.5061 2.3064 36.5862 2.44376 36.6591C3.05827 36.9653 3.91857 37.0673 3.91857 37.0673C5.10421 37.2058 5.41507 37.2131 5.41507 37.2131C7.38872 37.3881 10.3383 37.5849 15.0664 37.5849C15.0664 37.5849 15.0809 37.5849 15.0881 37.5849C15.0953 37.5849 15.1026 37.5849 15.1098 37.5849C19.8379 37.5849 22.7875 37.3881 24.7611 37.2131C24.7611 37.2131 25.072 37.2131 26.2576 37.0673C26.2576 37.0673 27.1179 36.9653 27.7324 36.6591C27.8698 36.5935 27.9927 36.5061 27.9927 36.5061C28.0867 36.4404 28.1879 36.3676 28.2891 36.2582C28.2891 36.2582 28.8241 35.7188 29.0988 33.9694C29.0988 33.9694 29.0988 33.9548 29.0988 33.9402C30.0242 27.9119 29.8507 21.1765 29.8507 21.1765H29.8651Z" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M14.958 12.6845C8.40807 11.7514 4.05593 8.11404 3.07996 0.32172C12.0445 2.12948 13.7506 4.87028 14.958 12.6845Z" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M22.2597 4.5787C17.3003 5.47529 15.0736 8.38374 14.6471 12.5678C14.7483 12.6116 14.8568 12.648 14.958 12.6845C19.7366 11.6421 21.4139 10.3373 22.2525 4.5787H22.2597Z" />
                    </svg>
                </div>

                <button id="hamprgerButton" class="block focus:outline-none" (click)="toggleMenu()"
                    aria-label="Toggle menu">
                    <svg [ngClass]="menuOpen ? 'hidden' : 'block'" xmlns="http://www.w3.org/2000/svg" id="brand-text2"
                        class="h-7 w-7 text-[var(--primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16" />
                    </svg>

                    <svg [ngClass]="menuOpen ? 'block' : 'hidden'" xmlns="http://www.w3.org/2000/svg" id="brand-text3"
                        class="h-7 w-7 text-[var(--primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>

            </div>
        </div>
    </div>
</header>